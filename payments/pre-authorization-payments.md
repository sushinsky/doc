# Двухстадийные платежи \(платежи с преаворизацией\)

Инициировать создание платежа с преавторизацией можно, использовав при [создании платежа](create-payment.md) дополнительный параметр **preauth**.

|  | Значение | Описание |
| :--- | :--- | :--- |
| **preauth** | true/false | Используйте этот флаг для создания платежа с преавторизацией, по умолчанию флаг выключен и значение равно 0 |
| **preauthExpireLogic** | число | Поле для логики блокировки платежей с преавторизацией    0 - При отсутствии запроса на подтверждение или отмену, платеж по истечении срока блокировки на стороне банка-эквайера \(~114 часов после создания платежа\) будет подтвержден  1 - При отсутствии запроса на подтверждение или отмену, платеж по истечении срока блокировки на стороне банка-эквайера \(~114 часов после создания платежа\) будет отменен.   Если параметр не будет использован, платеж будет отменен по истечении срока. |

#### 

#### Подтверждение платежа с преавторизацией

Для подтверждения платежа с преавторизацией \(списания заблокированных на карте плательщика средств\) необходимо выполнить GET-запрос:[https://unitpay.ru/api?](https://unitpay.ru/api?)   
     method=confirmPayment     
      params\[paymentId\]=1     
      params\[secretKey\]=ключ

|  | Значение | Описание |
| :--- | :--- | :--- |
| paymentId | число | ID платежа в системе UnitPay. |
| secretKey | строка | Секретный ключ проекта. |

**Успешный ответ при подтверждении платежа с преавторизацией**

```text
{ "message": "Блокировка успешно отменёна" }
```

**Ошибочный ответ при подтверждении платежа с преавторизацией**

```text
{"error": 
{ "message": "Платеж не может быть отменен" }}
```

|  | Значение | Описание |
| :--- | :--- | :--- |
| message | строка | Информация с описанием ошибки запроса.    |

#### 

#### Отмена платежа с преавторизацией

Для отмены платежа с преавторизацией \(разблокировки средств на карте плательщика\) необходимо выполнить GET-запрос:[https://unitpay.ru/api?](https://unitpay.ru/api?)   
     method=cancelPayment    
      params\[paymentId\]=1    
      params\[secretKey\]=ключ

|  | Значение | Описание |
| :--- | :--- | :--- |
| paymentId | число | ID платежа в системе UnitPay. |
| secretKey | строка | Секретный ключ проекта. |

**Успешный ответ при отмене платежа с преавторизацией**

```text
{ "message": "Блокировка успешно отменёна" }
```

**Ошибочный ответ при отмене платежа с преавторизацией**

```text
{"error": 
{ "message": "Платеж не может быть отменен" }}
```

|  | Значение | Описание |
| :--- | :--- | :--- |
| message | строка | Информация с описанием ошибки запроса. |

